<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>學生點數查詢</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h1>學生點數查詢</h1>
  <div id="user"></div>
  <div id="points"></div>
  <div id="products"></div>
  <script>
    liff.init({ liffId: "2008129060-mO9azRD1" }) // 這裡填你的 LIFF ID
      .then(() => liff.getProfile())
      .then(profile => {
        document.getElementById('user').innerText = "你好，" + profile.displayName;
        // 用 userId 查詢 Google Sheets API
        const userId = profile.userId;
        fetch(`https://script.google.com/macros/s/AKfycbzTydYK4bP8qKbW7sZ1yB0BVmVA7gVOu41AeTwkjUSrg4_zqvZ3kPPuO1a8ErfSUcjb/exec?userId=${userId}`) // 這裡填你的 API 網址
          .then(res => res.json())
          .then(data => {
            document.getElementById('points').innerText = "你的點數：" + data.points;
            let html = "<h2>商品列表</h2><ul>";
            data.products.forEach(p => {
              html += `<li>${p[0]}：${p[1]} 點</li>`;
            });
            html += "</ul>";
            document.getElementById('products').innerHTML = html;
          });
      })
      .catch(err => {
        document.body.innerHTML = "<h2>發生錯誤，請重新開啟！</h2>";
        console.error(err);
      });
  </script>
</body>
</html>
