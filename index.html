<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>學生點數查詢</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h1>學生點數查詢</h1>
  <div id="user"></div>
  <div id="points"></div>
  <div id="products"></div>
  <script>
    liff.init({ liffId: "2008129060-mO9azRD1" })
      .then(() => liff.getProfile())
      .then(profile => {
        document.getElementById('user').innerText = "你好，" + profile.displayName;
        // 用 userId 查詢 Google Sheets API
        const userId = profile.userId;
        fetch(`https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjDYHxB63onuwg8CgVdBlpe4Ek4scj0sOdpSRdwd8RS-XYfTSsujsIdzXFu10m8IEWIBaOWMg8NiLKFIG92ERYtJshRIGMFqgug6tH25NQA_sYafoSQcs4raxlIUqLR6SVMvqzpCOa0ltBGVzWoC12tXUrOXYdG1f5T6WJS0qezZrYVcaN8YpfrGs8GLm47YZHPCG_JtJjIjTBW8BO-V4im3fpF_s4s_rqu_-m0mZF89gCZUuFFrIEowPcebSrcbZc3y4oKTlEsgwMjumNcpu4k0LVfdA&lib=MB_Zde0U7DwIpfp98Nohp6H-zIEpQ-sDt`)
          .then(res => res.json())
          .then(data => {
            document.getElementById('points').innerText = "你的點數：" + data.points;
            let html = "<h2>商品列表</h2><ul>";
            data.products.forEach(p => {
              html += `<li>${p[0]}：${p[1]} 點</li>`;
            });
            html += "</ul>";
            document.getElementById('products').innerHTML = html;
          });
      })
      .catch(err => {
        document.body.innerHTML = "<h2>發生錯誤，請重新開啟！</h2>";
        console.error(err);
      });
  </script>
</body>
</html>